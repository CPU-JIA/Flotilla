# SonarQube/SonarCloud 配置文件
# Phase 4 P4.5: 代码质量和安全分析

# 项目基本信息
sonar.projectKey=flotilla
sonar.projectName=Flotilla - Cloud Code Hosting Platform
sonar.projectVersion=1.0.0

# 组织信息 (SonarCloud)
# sonar.organization=your-organization-key

# 源代码路径
sonar.sources=apps/backend/src,apps/frontend/app,apps/frontend/components,website
sonar.tests=apps/backend/src,apps/frontend/tests

# 排除的文件和目录
sonar.exclusions=\
  **/node_modules/**,\
  **/dist/**,\
  **/build/**,\
  **/.next/**,\
  **/coverage/**,\
  **/*.spec.ts,\
  **/*.test.ts,\
  **/*.spec.tsx,\
  **/*.test.tsx,\
  **/prisma/migrations/**,\
  **/*.config.js,\
  **/*.config.ts

# 测试覆盖率
sonar.javascript.lcov.reportPaths=\
  apps/backend/coverage/lcov.info,\
  apps/frontend/coverage/lcov.info

sonar.typescript.lcov.reportPaths=\
  apps/backend/coverage/lcov.info,\
  apps/frontend/coverage/lcov.info

# 测试文件模式
sonar.test.inclusions=\
  **/*.spec.ts,\
  **/*.test.ts,\
  **/*.spec.tsx,\
  **/*.test.tsx

# TypeScript 配置
sonar.typescript.node=node

# 编码
sonar.sourceEncoding=UTF-8

# 语言
sonar.language=ts

# 代码重复检测
sonar.cpd.exclusions=\
  **/*.spec.ts,\
  **/*.test.ts

# 安全热点规则
sonar.security.hotspots.enabled=true

# 质量门禁阈值 (SonarCloud)
# 新代码覆盖率至少 80%
sonar.qualitygate.wait=true
sonar.qualitygate.timeout=300

# 代码行数统计
sonar.scm.provider=git

# Pull Request 分析 (SonarCloud)
# sonar.pullrequest.provider=GitHub
# sonar.pullrequest.github.repository=your-org/flotilla

# 分支分析
sonar.branch.name=${GITHUB_REF_NAME:-main}

# 扫描的文件扩展名
sonar.inclusions=\
  **/*.ts,\
  **/*.tsx,\
  **/*.js,\
  **/*.jsx

# 问题忽略模式
# 例如: 忽略生成的 Prisma Client 文件
sonar.issue.ignore.multicriteria=e1

sonar.issue.ignore.multicriteria.e1.ruleKey=typescript:S*
sonar.issue.ignore.multicriteria.e1.resourceKey=**/prisma/generated/**

# 安全规则集
# OWASP Top 10
sonar.security.owaspTop10.enabled=true

# CWE Top 25
sonar.security.cweTop25.enabled=true

# SANS Top 25
sonar.security.sansTop25.enabled=true

# 代码异味检测
sonar.technicalDebt.hoursInDay=8

# 分析详细程度
sonar.verbose=false
sonar.log.level=INFO

# 并行处理
sonar.cpd.threads=2
sonar.analysis.threads=2

# 插件配置
# TypeScript 插件
sonar.typescript.tsconfigPath=tsconfig.json

# 排除已知的第三方问题
sonar.issue.ignore.allfile=1
sonar.issue.ignore.allfile.1.fileRegexp=.*\\.d\\.ts
sonar.issue.ignore.allfile.1.rulePattern=.*

# 代码复杂度阈值
sonar.complexity.threshold=15

# 文件大小限制
sonar.size.limit=500000

# 注释
# 最小注释密度
sonar.commentsDensity.minDensity=10
