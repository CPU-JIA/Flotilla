# æµ‹è¯•è®¡åˆ’æ–‡æ¡£

**é¡¹ç›®åç§°ï¼š** åŸºäºäº‘è®¡ç®—çš„å¼€å‘åä½œå¹³å°ï¼ˆFlotillaï¼‰
**ç‰ˆæœ¬ï¼š** v2.0ï¼ˆåŸºäºå®ç°çŠ¶æ€æ›´æ–°ï¼‰
**ç¼–å†™æ—¥æœŸï¼š** 2025-10-15
**æœ€åæ›´æ–°ï¼š** 2025-12-22
**ç¼–å†™äººï¼š** JIA
**å®¡æ ¸äººï¼š** -
**æ‰¹å‡†äººï¼š** -

---

> **å®ç°çŠ¶æ€è¯´æ˜**: âœ… å·²å®ç° | âš ï¸ éƒ¨åˆ†å®ç° | âŒ æœªå®ç°
>
> æœ¬æµ‹è¯•è®¡åˆ’å·²åŸºäºå®é™…æµ‹è¯•æ–‡ä»¶æ›´æ–°ï¼Œå½“å‰åŒ…å« **20ä¸ªåç«¯å•å…ƒæµ‹è¯•** å’Œ **28ä¸ªå‰ç«¯E2Eæµ‹è¯•**ã€‚

---

## 1. å¼•è¨€

### 1.1 æµ‹è¯•ç›®æ ‡

æœ¬æµ‹è¯•è®¡åˆ’æ—¨åœ¨ç¡®ä¿"åŸºäºäº‘è®¡ç®—çš„å¼€å‘åä½œå¹³å°"æ»¡è¶³éœ€æ±‚åˆ†ææ–‡æ¡£ä¸­å®šä¹‰çš„æ‰€æœ‰åŠŸèƒ½æ€§å’ŒéåŠŸèƒ½æ€§éœ€æ±‚ï¼ŒéªŒè¯ç³»ç»Ÿçš„æ­£ç¡®æ€§ã€ç¨³å®šæ€§ã€æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚

### 1.2 æµ‹è¯•èŒƒå›´

**åŒ…å«èŒƒå›´ï¼š**

- âœ… ç”¨æˆ·è®¤è¯æ¨¡å—ï¼ˆæ³¨å†Œã€ç™»å½•ã€é‚®ç®±éªŒè¯ã€å¯†ç é‡ç½®ï¼‰
- âœ… é¡¹ç›®ç®¡ç†æ¨¡å—ï¼ˆCRUDæ“ä½œï¼‰
- âœ… ä»£ç ä»“åº“æ¨¡å—ï¼ˆæ–‡ä»¶ä¸Šä¼ ã€æµè§ˆã€ç‰ˆæœ¬ç®¡ç†ï¼‰
- âœ… åä½œæƒé™æ¨¡å—ï¼ˆæˆå‘˜ç®¡ç†ã€è§’è‰²æ§åˆ¶ï¼‰
- âœ… åˆ†å¸ƒå¼å…±è¯†æ¨¡å—ï¼ˆRaftç®—æ³•ï¼‰
- âœ… ç®¡ç†å‘˜åŠŸèƒ½æ¨¡å—
- âœ… ç»„ç»‡ä¸å›¢é˜Ÿæ¨¡å—ï¼ˆä¸‰å±‚æƒé™æ¶æ„ï¼‰
- âœ… Issueè¿½è¸ªæ¨¡å—ï¼ˆæ ‡ç­¾ã€é‡Œç¨‹ç¢‘ã€è¯„è®ºï¼‰
- âœ… Pull Requestæ¨¡å—ï¼ˆå®¡æŸ¥ã€åˆå¹¶ã€è¡Œçº§è¯„è®ºï¼‰
- âœ… ä»£ç æœç´¢æ¨¡å—ï¼ˆå…¨æ–‡æœç´¢ã€è¯­è¨€è§£æï¼‰
- âœ… åˆ†æ”¯ä¿æŠ¤æ¨¡å—ï¼ˆä¿æŠ¤è§„åˆ™é…ç½®ï¼‰
- âœ… é€šçŸ¥æ¨¡å—ï¼ˆå®æ—¶é€šçŸ¥ï¼‰

**ä¸åŒ…å«èŒƒå›´ï¼š**

- âŒ ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆï¼ˆOAuthã€äº‘å­˜å‚¨å•†ä¸šAPIï¼‰
- âŒ ç§»åŠ¨ç«¯åŸç”Ÿåº”ç”¨
- âŒ æ€§èƒ½å‹åŠ›æµ‹è¯•ï¼ˆè¶…è¿‡1000å¹¶å‘ï¼‰

### 1.3 æµ‹è¯•ç­–ç•¥

é‡‡ç”¨**é‡‘å­—å¡”æµ‹è¯•æ¨¡å‹**ï¼š

```
        /\
       /E2E\        <- 10% (å…³é”®ç”¨æˆ·è·¯å¾„)
      /------\
     /  é›†æˆ  \      <- 30% (APIæ¥å£æµ‹è¯•)
    /----------\
   /   å•å…ƒæµ‹è¯•  \   <- 60% (æ ¸å¿ƒä¸šåŠ¡é€»è¾‘)
  /--------------\
```

---

## 2. æµ‹è¯•ç¯å¢ƒ

### 2.1 ç¡¬ä»¶ç¯å¢ƒ

| ç»„ä»¶   | é…ç½®                                          |
| ------ | --------------------------------------------- |
| å¼€å‘æœº | CPU: Intel i7-12700, RAM: 32GB, Disk: 1TB SSD |
| æœåŠ¡å™¨ | Dockerå®¹å™¨åŒ–éƒ¨ç½²ï¼Œåˆ†é…4æ ¸8GBå†…å­˜              |

### 2.2 è½¯ä»¶ç¯å¢ƒ

| è½¯ä»¶       | ç‰ˆæœ¬                 |
| ---------- | -------------------- |
| æ“ä½œç³»ç»Ÿ   | Windows 11 / MSYS_NT |
| Node.js    | v20.x                |
| pnpm       | v9.x                 |
| PostgreSQL | 16                   |
| Redis      | 7                    |
| MinIO      | RELEASE.2024-12-13   |
| Docker     | 27.x                 |
| Playwright | 1.50.0               |
| Jest       | 29.x                 |

### 2.3 æµ‹è¯•æ•°æ®

**æµ‹è¯•è´¦æˆ·ï¼š**

- è¶…çº§ç®¡ç†å‘˜ï¼š`jia` / `Jia123456`
- æ™®é€šç”¨æˆ·1ï¼š`testuser1` / `Test123456`
- æ™®é€šç”¨æˆ·2ï¼š`testuser2` / `Test123456`

**æµ‹è¯•é¡¹ç›®ï¼š**

- å…¬å¼€é¡¹ç›®ï¼š`test-public-project`
- ç§æœ‰é¡¹ç›®ï¼š`test-private-project`

---

## 3. æµ‹è¯•ç±»å‹ä¸æ–¹æ³•

### 3.1 å•å…ƒæµ‹è¯• (Unit Testing)

**ç›®æ ‡ï¼š** éªŒè¯å„æ¨¡å—å†…éƒ¨é€»è¾‘çš„æ­£ç¡®æ€§

**å·¥å…·ï¼š** Jest + ts-jest

**è¦†ç›–èŒƒå›´ï¼š**

- Serviceå±‚ä¸šåŠ¡é€»è¾‘ï¼ˆ60%ä¼˜å…ˆçº§ï¼‰
- å·¥å…·å‡½æ•°å’Œè¾…åŠ©ç±»
- æ•°æ®éªŒè¯å’Œè½¬æ¢é€»è¾‘

**æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹ï¼š**

```typescript
// projects.service.spec.ts
describe('ProjectsService', () => {
  it('should create a project with valid data', async () => {
    const dto = { name: 'test', visibility: 'PUBLIC' }
    const result = await service.create(dto, mockUser)
    expect(result.name).toBe('test')
  })

  it('should throw error for duplicate project name', async () => {
    await expect(service.create(existingDto, mockUser)).rejects.toThrow(
      'Project name already exists'
    )
  })
})
```

### 3.2 é›†æˆæµ‹è¯• (Integration Testing)

**ç›®æ ‡ï¼š** éªŒè¯æ¨¡å—é—´äº¤äº’å’ŒAPIç«¯ç‚¹æ­£ç¡®æ€§

**å·¥å…·ï¼š** Jest + Supertest

**è¦†ç›–èŒƒå›´ï¼š**

- Controllerå±‚APIç«¯ç‚¹
- æ•°æ®åº“äº¤äº’ï¼ˆPrismaï¼‰
- ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆï¼ˆMinIOï¼‰
- JWTè®¤è¯æµç¨‹

**æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹ï¼š**

```typescript
// auth.e2e-spec.ts
describe('AuthController (e2e)', () => {
  it('/auth/register (POST) - success', () => {
    return request(app.getHttpServer())
      .post('/api/auth/register')
      .send({ username: 'newuser', email: 'new@test.com', password: 'Pass123456' })
      .expect(201)
      .expect((res) => {
        expect(res.body.token).toBeDefined()
      })
  })

  it('/auth/login (POST) - invalid credentials', () => {
    return request(app.getHttpServer())
      .post('/api/auth/login')
      .send({ username: 'user', password: 'wrong' })
      .expect(401)
  })
})
```

### 3.3 ç«¯åˆ°ç«¯æµ‹è¯• (E2E Testing)

**ç›®æ ‡ï¼š** éªŒè¯å®Œæ•´ç”¨æˆ·åœºæ™¯å’Œä¸šåŠ¡æµç¨‹

**å·¥å…·ï¼š** Playwright

**è¦†ç›–èŒƒå›´ï¼š**

- ç”¨æˆ·æ³¨å†Œç™»å½•æµç¨‹
- é¡¹ç›®åˆ›å»ºå’Œç®¡ç†æµç¨‹
- ä»£ç æ–‡ä»¶ä¸Šä¼ å’Œæµè§ˆ
- æˆå‘˜é‚€è¯·å’Œæƒé™å˜æ›´
- ç®¡ç†å‘˜æ“ä½œæµç¨‹
- Rafté›†ç¾¤ç®¡ç†ç•Œé¢

**æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹ï¼š**

```typescript
// project-workflow.spec.ts
test('complete project workflow', async ({ page }) => {
  // 1. Login
  await page.goto('http://localhost:3000/auth/login')
  await page.fill('[name="username"]', 'jia')
  await page.fill('[name="password"]', 'Jia123456')
  await page.click('button[type="submit"]')

  // 2. Create project
  await page.goto('http://localhost:3000/projects')
  await page.click('text=åˆ›å»ºé¡¹ç›®')
  await page.fill('[name="name"]', 'e2e-test-project')
  await page.click('button[type="submit"]')

  // 3. Verify project created
  await expect(page.locator('text=e2e-test-project')).toBeVisible()
})
```

### 3.4 æ€§èƒ½æµ‹è¯• (Performance Testing)

**ç›®æ ‡ï¼š** éªŒè¯ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡

**å·¥å…·ï¼š** Artillery / K6

**æµ‹è¯•åœºæ™¯ï¼š**
| åœºæ™¯ | ç›®æ ‡ | éªŒæ”¶æ ‡å‡† |
|------|------|----------|
| APIå“åº”æ—¶é—´ | å¹³å‡å“åº” < 200ms | P95 < 500ms |
| æ–‡ä»¶ä¸Šä¼ é€Ÿåº¦ | 10MBæ–‡ä»¶ < 10s | ååé‡ > 1MB/s |
| å¹¶å‘ç”¨æˆ· | 100å¹¶å‘ç”¨æˆ·ç™»å½• | æˆåŠŸç‡ > 99% |
| æ•°æ®åº“æŸ¥è¯¢ | åˆ—è¡¨æŸ¥è¯¢ < 100ms | æ— æ…¢æŸ¥è¯¢ |

### 3.5 å®‰å…¨æµ‹è¯• (Security Testing)

**ç›®æ ‡ï¼š** éªŒè¯ç³»ç»Ÿå®‰å…¨æ€§

**æµ‹è¯•é¡¹ï¼š**

- âœ… SQLæ³¨å…¥é˜²æŠ¤ï¼ˆPrismaè‡ªåŠ¨é˜²æŠ¤ï¼‰
- âœ… XSSæ”»å‡»é˜²æŠ¤ï¼ˆReactè‡ªåŠ¨è½¬ä¹‰ï¼‰
- âœ… CSRFé˜²æŠ¤ï¼ˆJWT + SameSite Cookieï¼‰
- âœ… å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆbcryptï¼‰
- âœ… æƒé™è¶Šæƒæµ‹è¯•ï¼ˆRBACï¼‰
- âœ… æ•æ„Ÿä¿¡æ¯æ³„éœ²æµ‹è¯•

---

## 4. æµ‹è¯•ç”¨ä¾‹è®¾è®¡

### 4.1 ç”¨æˆ·è®¤è¯æ¨¡å—æµ‹è¯•ç”¨ä¾‹

| ç”¨ä¾‹ID      | æµ‹è¯•åœºæ™¯     | ä¼˜å…ˆçº§ | å‰ç½®æ¡ä»¶     | æµ‹è¯•æ­¥éª¤         | é¢„æœŸç»“æœ              |
| ----------- | ------------ | ------ | ------------ | ---------------- | --------------------- |
| TC-AUTH-001 | æ­£å¸¸æ³¨å†Œ     | P0     | æ—            | å¡«å†™æœ‰æ•ˆæ³¨å†Œä¿¡æ¯ | æ³¨å†ŒæˆåŠŸï¼Œè‡ªåŠ¨ç™»å½•    |
| TC-AUTH-002 | ç”¨æˆ·åé‡å¤   | P1     | ç”¨æˆ·åå·²å­˜åœ¨ | æ³¨å†Œç›¸åŒç”¨æˆ·å   | è¿”å›é”™è¯¯æç¤º          |
| TC-AUTH-003 | å¯†ç å¼ºåº¦ä¸è¶³ | P1     | æ—            | å¯†ç å°‘äº8ä½      | å‰ç«¯éªŒè¯å¤±è´¥          |
| TC-AUTH-004 | æ­£å¸¸ç™»å½•     | P0     | ç”¨æˆ·å·²æ³¨å†Œ   | è¾“å…¥æ­£ç¡®å‡­æ®     | ç™»å½•æˆåŠŸï¼Œè¿”å›token   |
| TC-AUTH-005 | å¯†ç é”™è¯¯     | P1     | ç”¨æˆ·å·²æ³¨å†Œ   | è¾“å…¥é”™è¯¯å¯†ç      | è¿”å›401é”™è¯¯           |
| TC-AUTH-006 | Tokenè¿‡æœŸ    | P1     | Tokenå·²è¿‡æœŸ  | è®¿é—®éœ€è®¤è¯æ¥å£   | è¿”å›401ï¼Œæç¤ºé‡æ–°ç™»å½• |

### 4.2 é¡¹ç›®ç®¡ç†æ¨¡å—æµ‹è¯•ç”¨ä¾‹

| ç”¨ä¾‹ID      | æµ‹è¯•åœºæ™¯     | ä¼˜å…ˆçº§ | å‰ç½®æ¡ä»¶       | æµ‹è¯•æ­¥éª¤       | é¢„æœŸç»“æœ           |
| ----------- | ------------ | ------ | -------------- | -------------- | ------------------ |
| TC-PROJ-001 | åˆ›å»ºé¡¹ç›®     | P0     | å·²ç™»å½•         | å¡«å†™é¡¹ç›®ä¿¡æ¯   | é¡¹ç›®åˆ›å»ºæˆåŠŸ       |
| TC-PROJ-002 | é¡¹ç›®åé‡å¤   | P1     | åŒåé¡¹ç›®å·²å­˜åœ¨ | åˆ›å»ºåŒåé¡¹ç›®   | è¿”å›é”™è¯¯           |
| TC-PROJ-003 | æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨ | P0     | å·²ç™»å½•         | è®¿é—®é¡¹ç›®åˆ—è¡¨   | æ˜¾ç¤ºç”¨æˆ·é¡¹ç›®       |
| TC-PROJ-004 | æœç´¢é¡¹ç›®     | P1     | å¤šä¸ªé¡¹ç›®å­˜åœ¨   | è¾“å…¥æœç´¢å…³é”®è¯ | è¿”å›åŒ¹é…é¡¹ç›®       |
| TC-PROJ-005 | æ›´æ–°é¡¹ç›®     | P1     | é¡¹ç›®å­˜åœ¨       | ä¿®æ”¹é¡¹ç›®ä¿¡æ¯   | æ›´æ–°æˆåŠŸ           |
| TC-PROJ-006 | åˆ é™¤é¡¹ç›®     | P1     | é¡¹ç›®å­˜åœ¨       | æ‰§è¡Œåˆ é™¤æ“ä½œ   | é¡¹ç›®åˆ é™¤ï¼Œæ•°æ®æ¸…ç† |

### 4.3 ä»£ç ä»“åº“æ¨¡å—æµ‹è¯•ç”¨ä¾‹

| ç”¨ä¾‹ID      | æµ‹è¯•åœºæ™¯     | ä¼˜å…ˆçº§ | å‰ç½®æ¡ä»¶     | æµ‹è¯•æ­¥éª¤       | é¢„æœŸç»“æœ         |
| ----------- | ------------ | ------ | ------------ | -------------- | ---------------- |
| TC-REPO-001 | ä¸Šä¼ æ–‡ä»¶     | P0     | é¡¹ç›®å·²åˆ›å»º   | ä¸Šä¼ ä»£ç æ–‡ä»¶   | æ–‡ä»¶ä¸Šä¼ æˆåŠŸ     |
| TC-REPO-002 | æ–‡ä»¶å¤§å°é™åˆ¶ | P1     | æ—            | ä¸Šä¼ >100MBæ–‡ä»¶ | è¿”å›é”™è¯¯æç¤º     |
| TC-REPO-003 | æµè§ˆæ–‡ä»¶æ ‘   | P0     | æ–‡ä»¶å·²ä¸Šä¼    | è®¿é—®æ–‡ä»¶åˆ—è¡¨   | æ˜¾ç¤ºæ–‡ä»¶æ ‘ç»“æ„   |
| TC-REPO-004 | ä¸‹è½½æ–‡ä»¶     | P0     | æ–‡ä»¶å·²ä¸Šä¼    | ç‚¹å‡»ä¸‹è½½       | æ–‡ä»¶æ­£ç¡®ä¸‹è½½     |
| TC-REPO-005 | åˆ›å»ºåˆ†æ”¯     | P1     | ä»“åº“å·²å­˜åœ¨   | åˆ›å»ºæ–°åˆ†æ”¯     | åˆ†æ”¯åˆ›å»ºæˆåŠŸ     |
| TC-REPO-006 | åˆ‡æ¢åˆ†æ”¯     | P1     | å¤šä¸ªåˆ†æ”¯å­˜åœ¨ | åˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯ | æ˜¾ç¤ºå¯¹åº”åˆ†æ”¯å†…å®¹ |
| TC-REPO-007 | æŸ¥çœ‹æäº¤å†å² | P1     | æœ‰æäº¤è®°å½•   | è®¿é—®æäº¤åˆ—è¡¨   | æ˜¾ç¤ºæ‰€æœ‰æäº¤     |

### 4.4 æƒé™æ§åˆ¶æ¨¡å—æµ‹è¯•ç”¨ä¾‹

| ç”¨ä¾‹ID      | æµ‹è¯•åœºæ™¯       | ä¼˜å…ˆçº§ | å‰ç½®æ¡ä»¶     | æµ‹è¯•æ­¥éª¤         | é¢„æœŸç»“æœ     |
| ----------- | -------------- | ------ | ------------ | ---------------- | ------------ |
| TC-PERM-001 | Owneræ·»åŠ æˆå‘˜  | P0     | ç”¨æˆ·æ˜¯Owner  | é‚€è¯·æ–°æˆå‘˜       | æˆå‘˜æ·»åŠ æˆåŠŸ |
| TC-PERM-002 | Memberæ·»åŠ æˆå‘˜ | P1     | ç”¨æˆ·æ˜¯Member | å°è¯•æ·»åŠ æˆå‘˜     | è¿”å›æƒé™é”™è¯¯ |
| TC-PERM-003 | ä¿®æ”¹æˆå‘˜è§’è‰²   | P1     | ç”¨æˆ·æ˜¯Owner  | ä¿®æ”¹æˆå‘˜ä¸ºMember | è§’è‰²æ›´æ–°æˆåŠŸ |
| TC-PERM-004 | ç§»é™¤æˆå‘˜       | P1     | ç”¨æˆ·æ˜¯Owner  | ç§»é™¤æˆå‘˜         | æˆå‘˜ç§»é™¤æˆåŠŸ |
| TC-PERM-005 | è®¿é—®ç§æœ‰é¡¹ç›®   | P1     | éæˆå‘˜ç”¨æˆ·   | è®¿é—®ç§æœ‰é¡¹ç›®     | è¿”å›403é”™è¯¯  |
| TC-PERM-006 | è®¿é—®å…¬å¼€é¡¹ç›®   | P0     | æœªç™»å½•ç”¨æˆ·   | è®¿é—®å…¬å¼€é¡¹ç›®     | å¯æŸ¥çœ‹å†…å®¹   |

### 4.5 Raftåˆ†å¸ƒå¼å…±è¯†æµ‹è¯•ç”¨ä¾‹

| ç”¨ä¾‹ID      | æµ‹è¯•åœºæ™¯   | ä¼˜å…ˆçº§ | å‰ç½®æ¡ä»¶     | æµ‹è¯•æ­¥éª¤       | é¢„æœŸç»“æœ         |
| ----------- | ---------- | ------ | ------------ | -------------- | ---------------- |
| TC-RAFT-001 | å¯åŠ¨é›†ç¾¤   | P0     | 3èŠ‚ç‚¹é…ç½®    | å¯åŠ¨é›†ç¾¤       | Leaderé€‰ä¸¾æˆåŠŸ   |
| TC-RAFT-002 | Leaderæ•…éšœ | P0     | é›†ç¾¤è¿è¡Œä¸­   | åœæ­¢LeaderèŠ‚ç‚¹ | æ–°Leaderè‡ªåŠ¨é€‰ä¸¾ |
| TC-RAFT-003 | æ—¥å¿—å¤åˆ¶   | P0     | é›†ç¾¤è¿è¡Œä¸­   | æäº¤å‘½ä»¤       | æ‰€æœ‰èŠ‚ç‚¹æ—¥å¿—ä¸€è‡´ |
| TC-RAFT-004 | èŠ‚ç‚¹æ¢å¤   | P1     | èŠ‚ç‚¹æ›¾ç»æ•…éšœ | é‡å¯æ•…éšœèŠ‚ç‚¹   | è‡ªåŠ¨åŒæ­¥æ•°æ®     |
| TC-RAFT-005 | ç½‘ç»œåˆ†åŒº   | P1     | é›†ç¾¤è¿è¡Œä¸­   | æ¨¡æ‹Ÿç½‘ç»œåˆ†åŒº   | å¤šæ•°æ´¾ç»§ç»­æœåŠ¡   |

---

## 5. æµ‹è¯•è¿›åº¦å®‰æ’

### 5.1 æµ‹è¯•é˜¶æ®µåˆ’åˆ†

```
Week 1: å•å…ƒæµ‹è¯•å¼€å‘ (60% coverage target)
  â”œâ”€ Day 1-2: Serviceå±‚æµ‹è¯•
  â”œâ”€ Day 3-4: Utilså’ŒHelpersæµ‹è¯•
  â””â”€ Day 5: ä¿®å¤å‘ç°çš„Bug

Week 2: é›†æˆæµ‹è¯•å¼€å‘ (API testing)
  â”œâ”€ Day 1-2: è®¤è¯å’Œç”¨æˆ·æ¨¡å—
  â”œâ”€ Day 3-4: é¡¹ç›®å’Œä»“åº“æ¨¡å—
  â””â”€ Day 5: Raftæ¨¡å—

Week 3: E2Eæµ‹è¯• + æ€§èƒ½æµ‹è¯•
  â”œâ”€ Day 1-3: Playwright E2E scenarios
  â”œâ”€ Day 4: æ€§èƒ½æµ‹è¯•è„šæœ¬
  â””â”€ Day 5: å®‰å…¨æµ‹è¯•

Week 4: æµ‹è¯•æŠ¥å‘Šä¸ä¼˜åŒ–
  â”œâ”€ Day 1-2: æ•´ç†æµ‹è¯•ç»“æœ
  â”œâ”€ Day 3-4: Bugä¿®å¤
  â””â”€ Day 5: æµ‹è¯•æŠ¥å‘Šç¼–å†™
```

### 5.2 èµ„æºåˆ†é…

| è§’è‰²       | è´£ä»»           | äººå‘˜ |
| ---------- | -------------- | ---- |
| æµ‹è¯•è´Ÿè´£äºº | æµ‹è¯•è®¡åˆ’ã€æŠ¥å‘Š | JIA  |
| åç«¯æµ‹è¯•   | å•å…ƒ+é›†æˆæµ‹è¯•  | JIA  |
| å‰ç«¯æµ‹è¯•   | E2Eæµ‹è¯•        | JIA  |
| æ€§èƒ½æµ‹è¯•   | æ€§èƒ½å’Œå®‰å…¨æµ‹è¯• | JIA  |

---

## 6. æµ‹è¯•å·¥å…·ä¸æ¡†æ¶

### 6.1 è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶

```typescript
// é¡¹ç›®æµ‹è¯•æŠ€æœ¯æ ˆ
{
  "backend": {
    "framework": "Jest",
    "e2e": "Supertest",
    "mocking": "jest.mock",
    "coverage": "Jest Coverage"
  },
  "frontend": {
    "e2e": "Playwright",
    "component": "React Testing Library",
    "mocking": "MSW (Mock Service Worker)"
  },
  "performance": {
    "load": "Artillery",
    "monitoring": "Prometheus + Grafana"
  }
}
```

### 6.2 CI/CDé›†æˆ

```yaml
# .github/workflows/test.yml (è®¡åˆ’)
name: Automated Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
      - name: Install dependencies
        run: pnpm install
      - name: Run backend tests
        run: pnpm --filter backend test:cov
      - name: Run E2E tests
        run: pnpm --filter frontend test
      - name: Upload coverage
        uses: codecov/codecov-action@v3
```

---

## 7. ç¼ºé™·ç®¡ç†

### 7.1 ç¼ºé™·ä¼˜å…ˆçº§å®šä¹‰

| ä¼˜å…ˆçº§    | å®šä¹‰                 | å¤„ç†æ—¶é—´ |
| --------- | -------------------- | -------- |
| P0 - è‡´å‘½ | ç³»ç»Ÿå´©æºƒã€æ•°æ®ä¸¢å¤±   | ç«‹å³ä¿®å¤ |
| P1 - ä¸¥é‡ | æ ¸å¿ƒåŠŸèƒ½æ— æ³•ä½¿ç”¨     | 24å°æ—¶å†… |
| P2 - ä¸€èˆ¬ | åŠŸèƒ½å¼‚å¸¸ä½†æœ‰æ›¿ä»£æ–¹æ¡ˆ | 3å¤©å†…    |
| P3 - è½»å¾® | ç•Œé¢é—®é¢˜ã€ä½“éªŒä¼˜åŒ–   | ä¸‹ä¸ªç‰ˆæœ¬ |

### 7.2 ç¼ºé™·æŠ¥å‘Šæ¨¡æ¿

```markdown
**ç¼ºé™·ID:** BUG-001
**å‘ç°æ—¥æœŸ:** 2025-10-15
**æŠ¥å‘Šäºº:** JIA
**ä¼˜å…ˆçº§:** P1
**æ‰€å±æ¨¡å—:** é¡¹ç›®ç®¡ç†

**ç¼ºé™·æè¿°:**
åˆ é™¤é¡¹ç›®æ—¶ï¼Œå…³è”çš„æ–‡ä»¶æœªä»MinIOåˆ é™¤

**å¤ç°æ­¥éª¤:**

1. åˆ›å»ºé¡¹ç›®å¹¶ä¸Šä¼ æ–‡ä»¶
2. åˆ é™¤é¡¹ç›®
3. æ£€æŸ¥MinIOå­˜å‚¨

**é¢„æœŸç»“æœ:** é¡¹ç›®å’Œæ–‡ä»¶å…¨éƒ¨åˆ é™¤
**å®é™…ç»“æœ:** é¡¹ç›®åˆ é™¤ï¼Œä½†MinIOæ–‡ä»¶æ®‹ç•™

**ä¿®å¤å»ºè®®:** åœ¨ProjectService.remove()ä¸­æ·»åŠ æ–‡ä»¶æ¸…ç†é€»è¾‘
```

---

## 8. æµ‹è¯•äº¤ä»˜ç‰©

### 8.1 æ–‡æ¡£äº¤ä»˜

- âœ… æµ‹è¯•è®¡åˆ’æ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£ï¼‰
- ğŸ”„ è½¯ä»¶æµ‹è¯•æŠ¥å‘Šï¼ˆå¾…ç”Ÿæˆï¼‰
- ğŸ”„ æµ‹è¯•ç”¨ä¾‹æ¸…å•ï¼ˆå¾…å®Œå–„ï¼‰
- ğŸ”„ ç¼ºé™·æŠ¥å‘Šæ±‡æ€»ï¼ˆå¾…æ•´ç†ï¼‰
- ğŸ”„ æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼ˆå¾…ç”Ÿæˆï¼‰

### 8.2 ä»£ç äº¤ä»˜

```
apps/backend/src/
â”œâ”€â”€ **/*.spec.ts          # å•å…ƒæµ‹è¯•æ–‡ä»¶
â””â”€â”€ test/
    â””â”€â”€ **/*.e2e-spec.ts  # é›†æˆæµ‹è¯•æ–‡ä»¶

apps/frontend/
â””â”€â”€ tests/
    â””â”€â”€ **/*.spec.ts      # Playwright E2Eæµ‹è¯•
```

---

## 9. æµ‹è¯•åº¦é‡æŒ‡æ ‡

### 9.1 ä»£ç è¦†ç›–ç‡ç›®æ ‡

| æ¨¡å—                | ç›®æ ‡è¦†ç›–ç‡ | å®é™…è¦†ç›–ç‡ | çŠ¶æ€      |
| ------------------- | ---------- | ---------- | --------- |
| Backend Services    | 80%        | 70%+       | âœ… å·²å®ç° |
| Backend Controllers | 70%        | 60%+       | âœ… å·²å®ç° |
| Raft Algorithm      | 85%        | 80%+       | âœ… å·²å®ç° |
| Search Module       | 75%        | 70%+       | âœ… å·²å®ç° |
| E2E Coverage        | 90%        | 95%+       | âœ… å·²å®ç° |

### 9.2 å·²å®ç°çš„æµ‹è¯•æ¸…å•

**åç«¯å•å…ƒæµ‹è¯•ï¼ˆ20ä¸ªæ–‡ä»¶ï¼‰ï¼š**

```
auth/auth.service.spec.ts           - è®¤è¯æœåŠ¡æµ‹è¯•
users/users.service.spec.ts         - ç”¨æˆ·æœåŠ¡æµ‹è¯•
users/users.controller.spec.ts      - ç”¨æˆ·æ§åˆ¶å™¨æµ‹è¯•
projects/projects.service.spec.ts   - é¡¹ç›®æœåŠ¡æµ‹è¯•
projects/projects.controller.spec.ts - é¡¹ç›®æ§åˆ¶å™¨æµ‹è¯•
repositories/repositories.service.spec.ts - ä»“åº“æœåŠ¡æµ‹è¯•
repositories/repositories.controller.spec.ts - ä»“åº“æ§åˆ¶å™¨æµ‹è¯•
files/files.service.spec.ts         - æ–‡ä»¶æœåŠ¡æµ‹è¯•
git/git.service.spec.ts             - GitæœåŠ¡æµ‹è¯•
git/guards/git-http-auth.guard.spec.ts - Gitè®¤è¯å®ˆå«æµ‹è¯•
issues/issues.service.spec.ts       - IssueæœåŠ¡æµ‹è¯•
pull-requests/pull-requests.service.spec.ts - PRæœåŠ¡æµ‹è¯•
search/search.service.spec.ts       - æœç´¢æœåŠ¡æµ‹è¯•
search/utils/language-detector.spec.ts - è¯­è¨€æ£€æµ‹æµ‹è¯•
search/utils/file-utils.spec.ts     - æ–‡ä»¶å·¥å…·æµ‹è¯•
search/parsers/typescript-parser.spec.ts - TSè§£æå™¨æµ‹è¯•
search/parsers/python-parser.spec.ts - Pythonè§£æå™¨æµ‹è¯•
search/parsers/java-parser.spec.ts  - Javaè§£æå™¨æµ‹è¯•
email/email.service.spec.ts         - é‚®ä»¶æœåŠ¡æµ‹è¯•
app.controller.spec.ts              - åº”ç”¨æ§åˆ¶å™¨æµ‹è¯•
```

**å‰ç«¯E2Eæµ‹è¯•ï¼ˆ28ä¸ªæ–‡ä»¶ï¼‰ï¼š**

```
auth/login.spec.ts                  - ç™»å½•æµ‹è¯•
auth/register.spec.ts               - æ³¨å†Œæµ‹è¯•
auth/email-verification.spec.ts     - é‚®ç®±éªŒè¯æµ‹è¯•
dashboard/dashboard.spec.ts         - ä»ªè¡¨æ¿æµ‹è¯•
projects/projects.spec.ts           - é¡¹ç›®ç®¡ç†æµ‹è¯•
settings/settings.spec.ts           - è®¾ç½®é¡µé¢æµ‹è¯•
admin/admin.spec.ts                 - ç®¡ç†å‘˜åŠŸèƒ½æµ‹è¯•
organizations/organization-crud.spec.ts - ç»„ç»‡CRUDæµ‹è¯•
teams/team-crud.spec.ts             - å›¢é˜ŸCRUDæµ‹è¯•
files/file-management.spec.ts       - æ–‡ä»¶ç®¡ç†æµ‹è¯•
files/file-upload-security.spec.ts  - æ–‡ä»¶ä¸Šä¼ å®‰å…¨æµ‹è¯•
editor/code-editor.spec.ts          - ä»£ç ç¼–è¾‘å™¨æµ‹è¯•
git/git-ui.spec.ts                  - Gitç•Œé¢æµ‹è¯•
issues/issue-crud.spec.ts           - Issueå¢åˆ æ”¹æŸ¥æµ‹è¯•
issues/issue-labels.spec.ts         - Issueæ ‡ç­¾æµ‹è¯•
issues/issue-milestones.spec.ts     - é‡Œç¨‹ç¢‘æµ‹è¯•
issues/issue-comments.spec.ts       - Issueè¯„è®ºæµ‹è¯•
issues/issue-search-filter.spec.ts  - Issueæœç´¢è¿‡æ»¤æµ‹è¯•
pull-requests/pr-workflow.spec.ts   - PRå·¥ä½œæµæµ‹è¯•
pull-requests/pr-merge.spec.ts      - PRåˆå¹¶æµ‹è¯•
pull-requests/pr-review-workflow.spec.ts - PRå®¡æŸ¥æµç¨‹æµ‹è¯•
pull-requests/pr-review-enhancement.spec.ts - PRå®¡æŸ¥å¢å¼ºæµ‹è¯•
pull-requests/pr-line-comments.spec.ts - PRè¡Œçº§è¯„è®ºæµ‹è¯•
branch-protection/branch-protection-rules.spec.ts - åˆ†æ”¯ä¿æŠ¤è§„åˆ™æµ‹è¯•
search/search.spec.ts               - æœç´¢åŠŸèƒ½æµ‹è¯•
theme/theme-toggle.spec.ts          - ä¸»é¢˜åˆ‡æ¢æµ‹è¯•
language/language-toggle.spec.ts    - è¯­è¨€åˆ‡æ¢æµ‹è¯•
theme-language/theme-language.spec.ts - ä¸»é¢˜è¯­è¨€è”åˆæµ‹è¯•
```

### 9.3 è´¨é‡é—¨ç¦æ ‡å‡†

```
âœ… æ‰€æœ‰P0/P1ç¼ºé™·ä¿®å¤å®Œæˆ
âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
âœ… é›†æˆæµ‹è¯•é€šè¿‡ç‡ 100%
âœ… E2Eæµ‹è¯•é€šè¿‡ç‡ â‰¥ 95%
âœ… æ— å®‰å…¨æ¼æ´
âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
```

---

## 10. é£é™©ä¸åº”å¯¹

### 10.1 æµ‹è¯•é£é™©

| é£é™©             | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½         |
| ---------------- | ---- | ---- | ---------------- |
| æ—¶é—´ä¸è¶³         | é«˜   | ä¸­   | ä¼˜å…ˆæµ‹è¯•æ ¸å¿ƒåŠŸèƒ½ |
| æµ‹è¯•ç¯å¢ƒä¸ç¨³å®š   | ä¸­   | ä½   | Dockerå®¹å™¨åŒ–éš”ç¦» |
| åˆ†å¸ƒå¼æµ‹è¯•å¤æ‚   | é«˜   | é«˜   | ç®€åŒ–Raftæµ‹è¯•åœºæ™¯ |
| æ€§èƒ½æµ‹è¯•èµ„æºä¸è¶³ | ä½   | ä¸­   | ä½¿ç”¨äº‘æœåŠ¡å™¨     |

---

## 11. é™„å½•

### 11.1 å‚è€ƒèµ„æ–™

1. éœ€æ±‚åˆ†ææ–‡æ¡£ v1.0
2. æ¶æ„è®¾è®¡æ–‡æ¡£ v1.0
3. Jestå®˜æ–¹æ–‡æ¡£
4. Playwrightå®˜æ–¹æ–‡æ¡£
5. Raftç®—æ³•è®ºæ–‡

### 11.2 æœ¯è¯­è¡¨

- **P0/P1/P2/P3**: ç¼ºé™·ä¼˜å…ˆçº§
- **E2E**: End-to-Endï¼Œç«¯åˆ°ç«¯æµ‹è¯•
- **Coverage**: ä»£ç è¦†ç›–ç‡
- **CI/CD**: æŒç»­é›†æˆ/æŒç»­éƒ¨ç½²

---

## 12. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ       | å˜æ›´å†…å®¹                                                                                                                                                                                                    | ä½œè€… |
| ---- | ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---- |
| v1.0 | 2025-10-15 | åˆå§‹ç‰ˆæœ¬ï¼Œå®šä¹‰æµ‹è¯•ç­–ç•¥å’Œç”¨ä¾‹æ¨¡æ¿                                                                                                                                                                            | JIA  |
| v2.0 | 2025-12-22 | æ ¹æ®å®ç°çŠ¶æ€å…¨é¢æ›´æ–°ï¼š<br>- æ–°å¢6ä¸ªæµ‹è¯•æ¨¡å—ï¼ˆç»„ç»‡ã€å›¢é˜Ÿã€Issueã€PRã€æœç´¢ã€åˆ†æ”¯ä¿æŠ¤ï¼‰<br>- æ·»åŠ 20ä¸ªåç«¯å•å…ƒæµ‹è¯•æ–‡ä»¶æ¸…å•<br>- æ·»åŠ 28ä¸ªå‰ç«¯E2Eæµ‹è¯•æ–‡ä»¶æ¸…å•<br>- æ›´æ–°æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡å’Œå®é™…çŠ¶æ€<br>- æ·»åŠ ç‰ˆæœ¬å†å² | JIA  |

---

**æ–‡æ¡£å®¡æ‰¹è®°å½•**

| è§’è‰² | å§“å | æ—¥æœŸ       | ç­¾å |
| ---- | ---- | ---------- | ---- |
| ç¼–å†™ | JIA  | 2025-10-15 | -    |
| å®¡æ ¸ | -    | -          | -    |
| æ‰¹å‡† | -    | -          | -    |

---

**æ–‡æ¡£ç»“æŸ**
