# 测试计划文档

**项目名称：** 基于云计算的开发协作平台
**版本：** v1.0
**编写日期：** 2025-10-15
**编写人：** JIA
**审核人：** -
**批准人：** -

---

## 1. 引言

### 1.1 测试目标

本测试计划旨在确保"基于云计算的开发协作平台"满足需求分析文档中定义的所有功能性和非功能性需求，验证系统的正确性、稳定性、性能和安全性。

### 1.2 测试范围

**包含范围：**
- ✅ 用户认证模块（注册、登录、权限）
- ✅ 项目管理模块（CRUD操作）
- ✅ 代码仓库模块（文件上传、浏览、版本管理）
- ✅ 协作权限模块（成员管理、角色控制）
- ✅ 分布式共识模块（Raft算法）
- ✅ 管理员功能模块

**不包含范围：**
- ❌ 第三方服务集成（OAuth、云存储商业API）
- ❌ 移动端原生应用
- ❌ 性能压力测试（超过1000并发）

### 1.3 测试策略

采用**金字塔测试模型**：
```
        /\
       /E2E\        <- 10% (关键用户路径)
      /------\
     /  集成  \      <- 30% (API接口测试)
    /----------\
   /   单元测试  \   <- 60% (核心业务逻辑)
  /--------------\
```

---

## 2. 测试环境

### 2.1 硬件环境

| 组件 | 配置 |
|------|------|
| 开发机 | CPU: Intel i7-12700, RAM: 32GB, Disk: 1TB SSD |
| 服务器 | Docker容器化部署，分配4核8GB内存 |

### 2.2 软件环境

| 软件 | 版本 |
|------|------|
| 操作系统 | Windows 11 / MSYS_NT |
| Node.js | v20.x |
| pnpm | v9.x |
| PostgreSQL | 16 |
| Redis | 7 |
| MinIO | RELEASE.2024-12-13 |
| Docker | 27.x |
| Playwright | 1.50.0 |
| Jest | 29.x |

### 2.3 测试数据

**测试账户：**
- 超级管理员：`jia` / `Jia123456`
- 普通用户1：`testuser1` / `Test123456`
- 普通用户2：`testuser2` / `Test123456`

**测试项目：**
- 公开项目：`test-public-project`
- 私有项目：`test-private-project`

---

## 3. 测试类型与方法

### 3.1 单元测试 (Unit Testing)

**目标：** 验证各模块内部逻辑的正确性

**工具：** Jest + ts-jest

**覆盖范围：**
- Service层业务逻辑（60%优先级）
- 工具函数和辅助类
- 数据验证和转换逻辑

**测试用例示例：**
```typescript
// projects.service.spec.ts
describe('ProjectsService', () => {
  it('should create a project with valid data', async () => {
    const dto = { name: 'test', visibility: 'PUBLIC' }
    const result = await service.create(dto, mockUser)
    expect(result.name).toBe('test')
  })

  it('should throw error for duplicate project name', async () => {
    await expect(service.create(existingDto, mockUser))
      .rejects.toThrow('Project name already exists')
  })
})
```

### 3.2 集成测试 (Integration Testing)

**目标：** 验证模块间交互和API端点正确性

**工具：** Jest + Supertest

**覆盖范围：**
- Controller层API端点
- 数据库交互（Prisma）
- 第三方服务集成（MinIO）
- JWT认证流程

**测试用例示例：**
```typescript
// auth.e2e-spec.ts
describe('AuthController (e2e)', () => {
  it('/auth/register (POST) - success', () => {
    return request(app.getHttpServer())
      .post('/api/auth/register')
      .send({ username: 'newuser', email: 'new@test.com', password: 'Pass123456' })
      .expect(201)
      .expect(res => {
        expect(res.body.token).toBeDefined()
      })
  })

  it('/auth/login (POST) - invalid credentials', () => {
    return request(app.getHttpServer())
      .post('/api/auth/login')
      .send({ username: 'user', password: 'wrong' })
      .expect(401)
  })
})
```

### 3.3 端到端测试 (E2E Testing)

**目标：** 验证完整用户场景和业务流程

**工具：** Playwright

**覆盖范围：**
- 用户注册登录流程
- 项目创建和管理流程
- 代码文件上传和浏览
- 成员邀请和权限变更
- 管理员操作流程
- Raft集群管理界面

**测试用例示例：**
```typescript
// project-workflow.spec.ts
test('complete project workflow', async ({ page }) => {
  // 1. Login
  await page.goto('http://localhost:3000/auth/login')
  await page.fill('[name="username"]', 'jia')
  await page.fill('[name="password"]', 'Jia123456')
  await page.click('button[type="submit"]')

  // 2. Create project
  await page.goto('http://localhost:3000/projects')
  await page.click('text=创建项目')
  await page.fill('[name="name"]', 'e2e-test-project')
  await page.click('button[type="submit"]')

  // 3. Verify project created
  await expect(page.locator('text=e2e-test-project')).toBeVisible()
})
```

### 3.4 性能测试 (Performance Testing)

**目标：** 验证系统性能指标

**工具：** Artillery / K6

**测试场景：**
| 场景 | 目标 | 验收标准 |
|------|------|----------|
| API响应时间 | 平均响应 < 200ms | P95 < 500ms |
| 文件上传速度 | 10MB文件 < 10s | 吞吐量 > 1MB/s |
| 并发用户 | 100并发用户登录 | 成功率 > 99% |
| 数据库查询 | 列表查询 < 100ms | 无慢查询 |

### 3.5 安全测试 (Security Testing)

**目标：** 验证系统安全性

**测试项：**
- ✅ SQL注入防护（Prisma自动防护）
- ✅ XSS攻击防护（React自动转义）
- ✅ CSRF防护（JWT + SameSite Cookie）
- ✅ 密码加密存储（bcrypt）
- ✅ 权限越权测试（RBAC）
- ✅ 敏感信息泄露测试

---

## 4. 测试用例设计

### 4.1 用户认证模块测试用例

| 用例ID | 测试场景 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|--------|----------|----------|----------|
| TC-AUTH-001 | 正常注册 | P0 | 无 | 填写有效注册信息 | 注册成功，自动登录 |
| TC-AUTH-002 | 用户名重复 | P1 | 用户名已存在 | 注册相同用户名 | 返回错误提示 |
| TC-AUTH-003 | 密码强度不足 | P1 | 无 | 密码少于8位 | 前端验证失败 |
| TC-AUTH-004 | 正常登录 | P0 | 用户已注册 | 输入正确凭据 | 登录成功，返回token |
| TC-AUTH-005 | 密码错误 | P1 | 用户已注册 | 输入错误密码 | 返回401错误 |
| TC-AUTH-006 | Token过期 | P1 | Token已过期 | 访问需认证接口 | 返回401，提示重新登录 |

### 4.2 项目管理模块测试用例

| 用例ID | 测试场景 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|--------|----------|----------|----------|
| TC-PROJ-001 | 创建项目 | P0 | 已登录 | 填写项目信息 | 项目创建成功 |
| TC-PROJ-002 | 项目名重复 | P1 | 同名项目已存在 | 创建同名项目 | 返回错误 |
| TC-PROJ-003 | 查看项目列表 | P0 | 已登录 | 访问项目列表 | 显示用户项目 |
| TC-PROJ-004 | 搜索项目 | P1 | 多个项目存在 | 输入搜索关键词 | 返回匹配项目 |
| TC-PROJ-005 | 更新项目 | P1 | 项目存在 | 修改项目信息 | 更新成功 |
| TC-PROJ-006 | 删除项目 | P1 | 项目存在 | 执行删除操作 | 项目删除，数据清理 |

### 4.3 代码仓库模块测试用例

| 用例ID | 测试场景 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|--------|----------|----------|----------|
| TC-REPO-001 | 上传文件 | P0 | 项目已创建 | 上传代码文件 | 文件上传成功 |
| TC-REPO-002 | 文件大小限制 | P1 | 无 | 上传>100MB文件 | 返回错误提示 |
| TC-REPO-003 | 浏览文件树 | P0 | 文件已上传 | 访问文件列表 | 显示文件树结构 |
| TC-REPO-004 | 下载文件 | P0 | 文件已上传 | 点击下载 | 文件正确下载 |
| TC-REPO-005 | 创建分支 | P1 | 仓库已存在 | 创建新分支 | 分支创建成功 |
| TC-REPO-006 | 切换分支 | P1 | 多个分支存在 | 切换到其他分支 | 显示对应分支内容 |
| TC-REPO-007 | 查看提交历史 | P1 | 有提交记录 | 访问提交列表 | 显示所有提交 |

### 4.4 权限控制模块测试用例

| 用例ID | 测试场景 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|--------|----------|----------|----------|
| TC-PERM-001 | Owner添加成员 | P0 | 用户是Owner | 邀请新成员 | 成员添加成功 |
| TC-PERM-002 | Member添加成员 | P1 | 用户是Member | 尝试添加成员 | 返回权限错误 |
| TC-PERM-003 | 修改成员角色 | P1 | 用户是Owner | 修改成员为Member | 角色更新成功 |
| TC-PERM-004 | 移除成员 | P1 | 用户是Owner | 移除成员 | 成员移除成功 |
| TC-PERM-005 | 访问私有项目 | P1 | 非成员用户 | 访问私有项目 | 返回403错误 |
| TC-PERM-006 | 访问公开项目 | P0 | 未登录用户 | 访问公开项目 | 可查看内容 |

### 4.5 Raft分布式共识测试用例

| 用例ID | 测试场景 | 优先级 | 前置条件 | 测试步骤 | 预期结果 |
|--------|----------|--------|----------|----------|----------|
| TC-RAFT-001 | 启动集群 | P0 | 3节点配置 | 启动集群 | Leader选举成功 |
| TC-RAFT-002 | Leader故障 | P0 | 集群运行中 | 停止Leader节点 | 新Leader自动选举 |
| TC-RAFT-003 | 日志复制 | P0 | 集群运行中 | 提交命令 | 所有节点日志一致 |
| TC-RAFT-004 | 节点恢复 | P1 | 节点曾经故障 | 重启故障节点 | 自动同步数据 |
| TC-RAFT-005 | 网络分区 | P1 | 集群运行中 | 模拟网络分区 | 多数派继续服务 |

---

## 5. 测试进度安排

### 5.1 测试阶段划分

```
Week 1: 单元测试开发 (60% coverage target)
  ├─ Day 1-2: Service层测试
  ├─ Day 3-4: Utils和Helpers测试
  └─ Day 5: 修复发现的Bug

Week 2: 集成测试开发 (API testing)
  ├─ Day 1-2: 认证和用户模块
  ├─ Day 3-4: 项目和仓库模块
  └─ Day 5: Raft模块

Week 3: E2E测试 + 性能测试
  ├─ Day 1-3: Playwright E2E scenarios
  ├─ Day 4: 性能测试脚本
  └─ Day 5: 安全测试

Week 4: 测试报告与优化
  ├─ Day 1-2: 整理测试结果
  ├─ Day 3-4: Bug修复
  └─ Day 5: 测试报告编写
```

### 5.2 资源分配

| 角色 | 责任 | 人员 |
|------|------|------|
| 测试负责人 | 测试计划、报告 | JIA |
| 后端测试 | 单元+集成测试 | JIA |
| 前端测试 | E2E测试 | JIA |
| 性能测试 | 性能和安全测试 | JIA |

---

## 6. 测试工具与框架

### 6.1 自动化测试框架

```typescript
// 项目测试技术栈
{
  "backend": {
    "framework": "Jest",
    "e2e": "Supertest",
    "mocking": "jest.mock",
    "coverage": "Jest Coverage"
  },
  "frontend": {
    "e2e": "Playwright",
    "component": "React Testing Library",
    "mocking": "MSW (Mock Service Worker)"
  },
  "performance": {
    "load": "Artillery",
    "monitoring": "Prometheus + Grafana"
  }
}
```

### 6.2 CI/CD集成

```yaml
# .github/workflows/test.yml (计划)
name: Automated Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
      - name: Install dependencies
        run: pnpm install
      - name: Run backend tests
        run: pnpm --filter backend test:cov
      - name: Run E2E tests
        run: pnpm --filter frontend test
      - name: Upload coverage
        uses: codecov/codecov-action@v3
```

---

## 7. 缺陷管理

### 7.1 缺陷优先级定义

| 优先级 | 定义 | 处理时间 |
|--------|------|----------|
| P0 - 致命 | 系统崩溃、数据丢失 | 立即修复 |
| P1 - 严重 | 核心功能无法使用 | 24小时内 |
| P2 - 一般 | 功能异常但有替代方案 | 3天内 |
| P3 - 轻微 | 界面问题、体验优化 | 下个版本 |

### 7.2 缺陷报告模板

```markdown
**缺陷ID:** BUG-001
**发现日期:** 2025-10-15
**报告人:** JIA
**优先级:** P1
**所属模块:** 项目管理

**缺陷描述:**
删除项目时，关联的文件未从MinIO删除

**复现步骤:**
1. 创建项目并上传文件
2. 删除项目
3. 检查MinIO存储

**预期结果:** 项目和文件全部删除
**实际结果:** 项目删除，但MinIO文件残留

**修复建议:** 在ProjectService.remove()中添加文件清理逻辑
```

---

## 8. 测试交付物

### 8.1 文档交付

- ✅ 测试计划文档（本文档）
- 🔄 软件测试报告（待生成）
- 🔄 测试用例清单（待完善）
- 🔄 缺陷报告汇总（待整理）
- 🔄 测试覆盖率报告（待生成）

### 8.2 代码交付

```
apps/backend/src/
├── **/*.spec.ts          # 单元测试文件
└── test/
    └── **/*.e2e-spec.ts  # 集成测试文件

apps/frontend/
└── tests/
    └── **/*.spec.ts      # Playwright E2E测试
```

---

## 9. 测试度量指标

### 9.1 代码覆盖率目标

| 模块 | 目标覆盖率 | 当前覆盖率 | 状态 |
|------|-----------|-----------|------|
| Backend Services | 80% | TBD | 🔄 |
| Backend Controllers | 70% | TBD | 🔄 |
| Raft Algorithm | 85% | TBD | 🔄 |
| Frontend Components | 60% | TBD | 🔄 |
| E2E Coverage | 90% | TBD | 🔄 |

### 9.2 质量门禁标准

```
✅ 所有P0/P1缺陷修复完成
✅ 单元测试覆盖率 ≥ 80%
✅ 集成测试通过率 100%
✅ E2E测试通过率 ≥ 95%
✅ 无安全漏洞
✅ 性能指标达标
```

---

## 10. 风险与应对

### 10.1 测试风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| 时间不足 | 高 | 中 | 优先测试核心功能 |
| 测试环境不稳定 | 中 | 低 | Docker容器化隔离 |
| 分布式测试复杂 | 高 | 高 | 简化Raft测试场景 |
| 性能测试资源不足 | 低 | 中 | 使用云服务器 |

---

## 11. 附录

### 11.1 参考资料

1. 需求分析文档 v1.0
2. 架构设计文档 v1.0
3. Jest官方文档
4. Playwright官方文档
5. Raft算法论文

### 11.2 术语表

- **P0/P1/P2/P3**: 缺陷优先级
- **E2E**: End-to-End，端到端测试
- **Coverage**: 代码覆盖率
- **CI/CD**: 持续集成/持续部署

---

**文档审批记录**

| 角色 | 姓名 | 日期 | 签名 |
|------|------|------|------|
| 编写 | JIA | 2025-10-15 | - |
| 审核 | - | - | - |
| 批准 | - | - | - |

---

**文档结束**
